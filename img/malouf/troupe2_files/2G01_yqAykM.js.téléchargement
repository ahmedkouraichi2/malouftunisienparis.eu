;/*FB_PKG_DELIM*/

__d("fastDeepCopy",[],(function(a,b,c,d,e,f){"use strict";function a(a){return typeof a==="object"&&a!==null?g(a):a}function g(a){var b=typeof a.constructor==="function"?a.constructor():{};if(Array.isArray(a))for(var c=0;c<a.length;++c){var d=a[c];b[c]=typeof d==="object"&&d!==null?g(d):d}else for(d in a){c=a[d];b[d]=typeof c==="object"&&c!==null?g(c):c}return b}f["default"]=a}),66);
__d("VideoUploadRetries",["$InternalEnum","EventEmitter","Random","fastDeepCopy","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({PREDICATE:"predicate",DELAY_RETRIES:"delay-retries",TOTAL_RETRIES:"total-retries",TOTAL_TIME:"total-time"}),i=function(){function a(a){this.$1=0,this.$2=0,this.$4=null,this.$5=null,this.$3=Date.now(),this.$6=a,this.$7=new(c("EventEmitter"))()}var b=a.prototype;b.resetDelay=function(){this.$1=0,this.$5=null};b.addListener=function(a,b){return this.$7.addListener(a,b)};b.$8=function(){var a=this.$6.backoff_ms,b=a.initial;b+=a.exp_base*Math.pow(a.exp_multiplier,this.$1-1);b=Math.min(b,a.max);b+=(d("Random").random()-.5)*a.jitter;return Math.round(b)};b.getTotalRetryCount=function(){return this.$2};b.$9=function(){return this.$5===null};b.handleRetry=function(a){this.$4=a.context;this.$5=this.$10(a.predicate);if(this.$9()){this.$1++;this.$2++;var b=this.$8();this.$7.emit("retry-attempted",{since_started_ms:this.$11(),retry_context:this.$4,delay_retry_count:this.$1,total_retry_count:this.$2,backoff_ms:b});a.retryHandler(b)}else this.$7.emit("retries-abandoned",{since_started_ms:this.$11(),retry_context:this.$4,delay_retry_count:this.$1,total_retry_count:this.$2,abandon_reason:this.$5}),a.failureHandler()};b.$11=function(){return Date.now()-this.$3};b.$10=function(a){if(a!=null&&a()===!1)return h.PREDICATE;a=this.$6.limits;if((a==null?void 0:a.delay_retry_count)!=null&&this.$1>=a.delay_retry_count)return h.DELAY_RETRIES;if((a==null?void 0:a.total_retry_count)!=null&&this.$2>=a.total_retry_count)return h.TOTAL_RETRIES;return(a==null?void 0:a.total_time_ms)!=null&&a.total_time_ms<=this.$11()?h.TOTAL_TIME:null};return a}(),j={backoff_ms:{initial:400,jitter:100,exp_base:100,exp_multiplier:1.5,max:8e3},limits:{total_retry_count:500,total_time_ms:1e3*60*60}},k=null;function l(a){a===void 0&&(a=!1);if(a||k==null){var b;k=c("fastDeepCopy")(j);a=function(a,b){a!=null&&b(a)};var d=k.backoff_ms,e=k.limits;a((b=c("qex"))._("2108"),function(a){return d.initial=a});a(b._("2109"),function(a){return d.jitter=a});a(b._("2110"),function(a){return d.exp_base=a});a(b._("2111"),function(a){return d.exp_multiplier=a});a(b._("2112"),function(a){return d.max=a});a(b._("2113"),function(a){return e.total_time_ms=a});a(b._("2114"),function(a){return e.delay_retry_count=a});a(b._("2115"),function(a){return e.total_retry_count=a})}return k}a=Object.freeze({createState:function(a){return new i((a=a)!=null?a:l())}});g.getActivePolicy=l;g.VideoUploadRetries=a}),98);